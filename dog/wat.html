<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect Crypto Wallet</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/web3modal/dist/web3modal.min.css">
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3modal"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.7.8/dist/umd/index.min.js"></script>
</head>
<body>
    <h1>Connect Your Crypto Wallet</h1>
    <button id="connect-wallet-btn">Connect Wallet</button>

    <script>
        // Provider options for Web3Modal
        const providerOptions = {
            walletconnect: {
                package: WalletConnectProvider,
                options: {
                    rpc: {
                        56: "https://bsc-dataseed.binance.org/" // BSC mainnet
                    },
                    qrcode: true
                }
            },
            injected: {
                package: null // MetaMask and browser wallets
            }
        };

        // Initialize Web3Modal
        const web3Modal = new Web3Modal({
            cacheProvider: false, // Disable cache for testing
            providerOptions
        });

        // Button click handler
        document.getElementById("connect-wallet-btn").addEventListener("click", async () => {
            try {
                console.log("Connecting to wallet...");

                // Trigger wallet connection popup
                const provider = await web3Modal.connect();

                console.log("Wallet connected!");

                // Initialize Web3 instance
                const web3 = new Web3(provider);

                // Get the connected accounts
                const accounts = await web3.eth.getAccounts();
                alert("Connected account: " + accounts[0]);

                // Check if the network is Binance Smart Chain (BSC)
                const chainId = await web3.eth.getChainId();
                if (chainId !== 56) {
                    alert("Please switch to Binance Smart Chain (BSC Mainnet).");
                }

                // Handle wallet events
                provider.on("accountsChanged", (accounts) => {
                    console.log("Accounts changed: ", accounts);
                });

                provider.on("chainChanged", (chainId) => {
                    console.log("Chain changed: ", chainId);
                });

                provider.on("disconnect", (error) => {
                    console.log("Disconnected: ", error);
                });
            } catch (error) {
                console.error("Connection failed: ", error);
                alert("Failed to connect wallet. Please try again.");
            }
        });

        // Check for mobile devices
        function isMobile() {
            return /android|iphone|ipad|ipod|mobile/i.test(navigator.userAgent);
        }

        // Adjust button text based on device type
        window.addEventListener("load", () => {
            const button = document.getElementById("connect-wallet-btn");
            if (isMobile()) {
                button.innerText = "Connect Wallet (Mobile Supported)";
                console.log("Mobile device detected.");
            } else {
                console.log("Desktop device detected.");
            }
        });
    </script>
</body>
</html>
